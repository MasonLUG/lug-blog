<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>GMU VPN Slicer | GMU Linux Users Group</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="GMU VPN Slicer" />
<meta name="author" content="Zach Osman" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Annoyed by being constantly on the GMU VPN? Try a Slicer!" />
<meta property="og:description" content="Annoyed by being constantly on the GMU VPN? Try a Slicer!" />
<link rel="canonical" href="masonlug.github.io/lug-blog/2021/06/22/gmu-vpn-slicer.html" />
<meta property="og:url" content="masonlug.github.io/lug-blog/2021/06/22/gmu-vpn-slicer.html" />
<meta property="og:site_name" content="GMU Linux Users Group" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-22T13:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="GMU VPN Slicer" />
<script type="application/ld+json">
{"description":"Annoyed by being constantly on the GMU VPN? Try a Slicer!","url":"masonlug.github.io/lug-blog/2021/06/22/gmu-vpn-slicer.html","@type":"BlogPosting","headline":"GMU VPN Slicer","dateModified":"2021-06-22T13:00:00+00:00","datePublished":"2021-06-22T13:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"masonlug.github.io/lug-blog/2021/06/22/gmu-vpn-slicer.html"},"author":{"@type":"Person","name":"Zach Osman"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/lug-blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="masonlug.github.io/lug-blog/feed.xml" title="GMU Linux Users Group" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/lug-blog/">GMU Linux Users Group</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/lug-blog/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">GMU VPN Slicer</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-06-22T13:00:00+00:00" itemprop="datePublished">Jun 22, 2021
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Zach Osman</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Annoyed by being constantly on the GMU VPN? Try a Slicer!</p>

<h2 id="background">Background</h2>

<p>A common problem I found was that I’d want to access GMU resources (namely <code class="language-plaintext highlighter-rouge">zeus.vse.gmu.edu</code>) while not having my internet be slowed down by being connected to the GMU VPN.</p>

<p>The solution that worked early in my time at GMU was to ssh jump into <code class="language-plaintext highlighter-rouge">zeus</code> from <code class="language-plaintext highlighter-rouge">mason.gmu.edu</code> (another student accessable linux machine), as <code class="language-plaintext highlighter-rouge">mason</code> was accessable from outside the VPN, whereas <code class="language-plaintext highlighter-rouge">zues</code> was not.</p>

<p>Somewhat recently <code class="language-plaintext highlighter-rouge">mason</code> followed <code class="language-plaintext highlighter-rouge">zues</code> and changed to no longer be publically accessable, and must be accessed from inside the GMU network, breaking the initial fix.</p>

<p>As for how I use this personally, this runs 24/7 on my RaspberryPI, and I’ve setup my ssh config to sshjump through my RaspberryPI to ping any of the vse servers, meaning any of my computer on my network can ssh jump into VSE through my RaspberryPI. This has saved me quite a lot of time and pain over the years.</p>

<h2 id="current-solution">Current Solution</h2>

<p>The VPN Slicer allows for traffic directed at specific domains to be routed through the VPN, whilst leaving the remaining traffic untouched.</p>

<p>For the implementation below, we will route the following domains through the VPN- <code class="language-plaintext highlighter-rouge">zeus-1.vse.gmu.edu zeus-2.vse.gmu.edu zeus.vse.gmu.edu mason.gmu.edu</code>, however you can add to this list as you see fit.</p>

<h2 id="implementation">Implementation</h2>

<p>This can be done multiple ways, below is how I did it.</p>

<p><strong>This will be similar to the GMU VPN implementation published last week, with the slight modification of slicing the VPN</strong></p>

<h4 id="dependencies">Dependencies</h4>
<!-- --protocol=anyconnect -->

<ul>
  <li><a href="http://www.infradead.org/openconnect/">OpenConnect</a></li>
</ul>

<p>Openconnect can likely be installed by your distribution package manager.</p>

<ul>
  <li><a href="https://github.com/dlenski/vpn-slice">Vpn-Slice</a></li>
</ul>

<p>Check the README for the install guide.</p>

<h4 id="first-use">First use</h4>

<p><code class="language-plaintext highlighter-rouge">openconnect vpn.gmu.edu -s "vpn-slice zeus.vse.gmu.edu"</code></p>

<p>Results:</p>

<p>Before VPN Connection:
<img src="/lug-blog/assets/2021-05-21-gmu-vpn-slicer/fig1.png" alt="Figure 1" /></p>

<p>VPN Connection:
<img src="/lug-blog/assets/2021-05-21-gmu-vpn-slicer/fig2.png" alt="Figure 2" /></p>

<p>After VPN Connection:
<img src="/lug-blog/assets/2021-05-21-gmu-vpn-slicer/fig3.png" alt="Figure 3" /></p>

<p>We can see that this last connection can connect to <code class="language-plaintext highlighter-rouge">zeus.vse.gmu.edu</code> but <em>cannot</em> connect to <code class="language-plaintext highlighter-rouge">mason.gmu.edu</code>, as we didn’t specify that address in the sliced domain list for the VPN. This is the expected behaviour.</p>

<h4 id="easier-startup">Easier Startup</h4>

<p>Lets make a directory for this.</p>

<p><code class="language-plaintext highlighter-rouge">mkdir gmu-vpn-slicer</code></p>

<p>and</p>

<p><code class="language-plaintext highlighter-rouge">cd gmu-vpn-slicer</code></p>

<p>We put the below file inside, as this will fill in the prompts given to us during the <code class="language-plaintext highlighter-rouge">openconnect</code> connection process, and will allow us to automate this later.</p>

<p>(Be sure to fill in VPN_USER with your masonlive ID)</p>

<p><code class="language-plaintext highlighter-rouge">vpn-slicer.sh</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="nv">SERVER</span><span class="o">=</span>vpn.gmu.edu
<span class="nv">SLICE_SERVERS</span><span class="o">=</span><span class="s1">'zeus-1.vse.gmu.edu zeus-2.vse.gmu.edu zeus.vse.gmu.edu mason.gmu.edu'</span>
<span class="nv">VPN_USER</span><span class="o">=</span>
<span class="nv">TYPE</span><span class="o">=</span>STUDENT
<span class="nv">PASS_FILE</span><span class="o">=</span>.pass_file

<span class="nb">cat</span> <span class="s2">"</span><span class="nv">$PASS_FILE</span><span class="s2">"</span> | openconnect <span class="s2">"</span><span class="nv">$SERVER</span><span class="s2">"</span> <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$VPN_USER</span><span class="s2">"</span> <span class="nt">-s</span> <span class="s2">"vpn-slice </span><span class="nv">$SLICE_SERVERS</span><span class="s2">"</span> <span class="nt">-g</span> <span class="s2">"</span><span class="nv">$TYPE</span><span class="s2">"</span> <span class="nt">--passwd-on-stdin</span> <span class="nt">-v</span>
</code></pre></div></div>

<p>We need to make this file executable, so:</p>

<p><code class="language-plaintext highlighter-rouge">chmod +x ./vpn-slicer.sh</code></p>

<p>Lastly, we’ll need to create a password file, this will store your GMU password, so it’s critical that we secure this file.</p>

<p><code class="language-plaintext highlighter-rouge">.pass_file</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>your-vpn-password-here
</code></pre></div></div>

<p>And we’ll want to set that files permissions correctly so other users on your machine can’t read it.</p>

<p><code class="language-plaintext highlighter-rouge">chmod 600 ./.pass_file</code></p>

<p>And we’re done!</p>

<p>From here you can simply run <code class="language-plaintext highlighter-rouge">./vpn-slicer.sh</code> from inside the <code class="language-plaintext highlighter-rouge">gmu-vpn-slicer</code> directory and be connected.</p>

<h4 id="le-sunny-d">Le Sunny D</h4>

<p>Welcome to the official home of the most refreshing orange drink in existence.</p>

<p>We can create a SystemD service to have this start and run automatically, lets do that.</p>

<p>We can create the following file and place it in <code class="language-plaintext highlighter-rouge">/etc/systemd/system</code>, and we won’t have to start this manually.</p>

<p><code class="language-plaintext highlighter-rouge">vpn-slicer.service</code>:</p>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">GMU VPN</span>
<span class="py">After</span><span class="p">=</span><span class="s">network.target</span>

<span class="nn">[Service]</span>
<span class="py">User</span><span class="p">=</span><span class="s">root</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/bin/bash ./vpn.sh</span>
<span class="py">WorkingDirectory</span><span class="p">=</span><span class="s">/home/USER/PATH/TO/gmu-vpn-slicer</span>
<span class="py">Type</span><span class="p">=</span><span class="s">exec</span>
<span class="py">Restart</span><span class="p">=</span><span class="s">always</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span>
</code></pre></div></div>

<p>Next we load, enable, and start the service file with the following</p>

<p><code class="language-plaintext highlighter-rouge">sudo systemctl daemon-reload</code></p>

<p><code class="language-plaintext highlighter-rouge">sudo systemctl enable --now vpn-slicer</code></p>

<p>And we’re done!</p>

  </div><a class="u-url" href="/lug-blog/2021/06/22/gmu-vpn-slicer.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/lug-blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">GMU Linux Users Group</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">GMU Linux Users Group</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/masonlug"><svg class="svg-icon"><use xlink:href="/lug-blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">masonlug</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The Official Blog of the George Mason University Linux Users Group https://discord.gg/VEgGfVsTjR</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
